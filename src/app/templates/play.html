{% extends "base.html" %}

{% block title %}{{ stream.name }} - ProxiMeter{% endblock %}

{% block header_class %}header-playing{% endblock %}

{% block content %}
<main class="playback-container">
  <!-- Back button -->
  <div class="playback-controls">
    <a href="/" class="btn btn-secondary back-btn">← Back to Streams</a>
  </div>
  
  <!-- Stream info -->
  <div class="stream-info">
    <h2>{{ stream.name }}</h2>
    {% if stream.status == "Inactive" %}
    <div class="warning-banner" role="alert">
      <strong>⚠ Warning:</strong> This stream was marked as inactive. It may not be reachable.
    </div>
    {% endif %}
  </div>
  
  <!-- MJPEG playback -->
  <div class="playback-viewer">
    <img 
      src="/api/streams/play/{{ stream.id }}.mjpg" 
      alt="{{ stream.name }} live stream"
      class="stream-video"
      id="stream-video"
      onerror="handleStreamError()"
    >
  </div>
  
  <!-- Error banner (hidden by default, shown on playback failure) -->
  <div class="error-banner" id="playback-error" style="display: none;" role="alert">
    <strong>Playback Error:</strong> 
    <span id="error-message">Failed to load stream. The camera may be offline or unreachable.</span>
    <br>
    <a href="/" class="error-link">Return to stream list</a>
  </div>
</main>

<script>
function handleStreamError() {
  // Show error banner when stream fails to load
  const errorBanner = document.getElementById('playback-error');
  const streamVideo = document.getElementById('stream-video');
  
  if (errorBanner && streamVideo) {
    streamVideo.style.display = 'none';
    errorBanner.style.display = 'block';
  }
}
</script>
{% endblock %}
